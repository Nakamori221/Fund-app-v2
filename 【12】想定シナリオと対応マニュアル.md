実運用で遭遇する可能性が高いシナリオと、その対応方法をまとめます。
# 想定シナリオ対応マニュアル

## シナリオ1: 公開情報が極端に少ない（ステルスモード企業）

### 状況
```
- 公式Webサイトがランディングページのみ
- プレスリリースなし
- SNSも非公開
- Crunchbaseに登録なし
```

### 問題
PUB/EXT収集がほとんど機能しない

### 対応手順

#### Step 1: 利用可能な情報源を確認
```yaml
確認項目:
  □ 法人登記情報（商業登記簿）
  □ 特許出願情報（J-PlatPat）
  □ ニュースメディアの記事
  □ 創業者のLinkedIn/X（旧Twitter）
  □ 採用情報（Wantedly等）
  □ 競合他社の資料での言及
```

#### Step 2: 代替アプローチ
```python
# 1. 登記情報から基本情報を取得
basic_info = {
    "company_name": "商業登記簿から取得",
    "location": "登記住所",
    "founded_date": "設立年月日",
    "capital": "資本金",
    "officers": "役員名"
}

# 2. 特許から技術情報を推測
patent_info = search_patents(company_name)
technology_focus = analyze_patent_claims(patent_info)

# 3. 創業者の経歴から推測
founder_background = get_linkedin_profile(founder_name)
team_strength = assess_experience(founder_background)
```

#### Step 3: インタビューの早期実施
```markdown
ステルスモードの場合、早期にINTを実施：

【質問項目を拡大】
- 事業内容の詳細説明
- プロダクトのデモ
- 顧客事例（NDA下）
- 競合との差別化
- 技術的優位性
- チームの経歴
- これまでの実績

【証拠の収集】
- ピッチデック（機密版）
- プロダクトの画面キャプチャ
- 顧客からのLOI（意向表明書）
- トラクションデータ（ダッシュボード画面共有）
```

#### Step 4: 資料への記載方法
```markdown
## 情報収集の制約

本案件は創業初期のステルスモード企業であり、公開情報が極めて限定的である。
そのため、本資料は主に以下の情報源に基づく：

- **INT**: 経営陣への直接インタビュー（2024-10-15実施）
- **CONF**: 提供された社内資料（ピッチデック、財務計画）
- **PUB**: 法人登記情報のみ

公開情報による裏付けが困難なため、経営陣の発言の信憑性が投資判断の
重要な要素となる。リファレンスチェックの実施を強く推奨する。
```

---

## シナリオ2: 複数の事業ラインがあり複雑

### 状況
```
- メイン事業: SaaS
- サブ事業A: コンサルティング
- サブ事業B: ハードウェア販売
- 各事業のKPIが異なる
```

### 問題
単一の収益モデルで分析できない

### 対応手順

#### Step 1: 事業ライン別に分解
```python
business_lines = [
    {
        "name": "SaaS事業",
        "revenue_model": "サブスクリプション",
        "kpis": {
            "mrr": 50_000_000,
            "arr": 600_000_000,
            "customer_count": 150,
            "arpu": 333_333,
            "churn_rate": 0.05,
            "ltv_cac_ratio": 4.2
        },
        "weight": 0.75  # 売上構成比
    },
    {
        "name": "コンサル事業",
        "revenue_model": "タイムチャージ",
        "kpis": {
            "consultants": 5,
            "billable_rate": 200_000,
            "utilization": 0.75,
            "monthly_revenue": 7_500_000
        },
        "weight": 0.15
    },
    {
        "name": "ハードウェア販売",
        "revenue_model": "単発販売",
        "kpis": {
            "units_sold": 200,
            "asp": 250_000,
            "gross_margin": 0.30,
            "monthly_revenue": 4_000_000
        },
        "weight": 0.10
    }
]
```

#### Step 2: 統合分析
```python
def analyze_multi_business(business_lines):
    """複数事業の統合分析"""
    
    # 1. 加重平均での全社KPI算出
    total_revenue = sum(bl['kpis']['monthly_revenue'] * 12 for bl in business_lines)
    weighted_gross_margin = sum(
        bl.get('gross_margin', 0.8) * bl['weight'] 
        for bl in business_lines
    )
    
    # 2. 事業別の成長性評価
    for bl in business_lines:
        bl['scalability'] = assess_scalability(bl['revenue_model'])
        bl['strategic_value'] = assess_strategic_value(bl)
    
    # 3. ポートフォリオ分析
    portfolio_analysis = {
        "core_business": max(business_lines, key=lambda x: x['weight']),
        "high_margin_business": max(business_lines, key=lambda x: x.get('gross_margin', 0)),
        "growth_potential": analyze_growth_synergies(business_lines)
    }
    
    return {
        "total_revenue": total_revenue,
        "weighted_metrics": {...},
        "business_lines": business_lines,
        "portfolio_analysis": portfolio_analysis,
        "recommendations": generate_recommendations(business_lines)
    }
```

#### Step 3: レポートでの記載
```markdown
## ビジネスモデル

当社は3つの事業ラインを展開している：

### 1. SaaS事業（売上構成比75%）
当社のコア事業。マーケティング自動化SaaSを提供。

**主要KPI**
- ARR: ¥600M
- ARPU: ¥333k/月
- LTV/CAC: 4.2x（健全）
- 解約率: 5%/月（改善余地あり）

**評価**: 高い粗利率（80%）とスケーラビリティ。投資価値の中心。

### 2. コンサルティング事業（15%）
SaaS導入支援とマーケティング戦略立案。

**主要KPI**
- コンサルタント: 5名
- 稼働率: 75%
- 月次売上: ¥7.5M

**評価**: 高粗利だが人数制約でスケールしにくい。
ただし、SaaS顧客獲得の入口として戦略的価値あり。

### 3. ハードウェア販売（10%）
マーケティング用のIoTデバイス。

**評価**: 低粗利（30%）、在庫リスクあり。
長期的には縮小またはOEM化を検討すべき。

### 統合評価

- **コア**: SaaS事業に集中し、80%以上への拡大を推奨
- **戦略的**: コンサルはSaaS販路として維持
- **縮小候補**: ハードウェアは戦略的価値が限定的
```

---

## シナリオ3: 財務データが大幅に矛盾

### 状況
```
ソースA（CONF-財務モデル）: ARR ¥300M
ソースB（INT-CEOインタビュー）: ARR ¥450M
差異: 50%
```

### 問題
どちらを信じるべきか不明、投資判断に重大な影響

### 対応手順

#### Step 1: 即座にエスカレーション
```python
def handle_critical_conflict(conflict):
    """重大な矛盾の処理"""
    
    # 1. 自動処理を停止
    workflow.pause()
    
    # 2. 緊急通知
    send_urgent_notification(
        to=["lead_partner", "analyst"],
        subject="【緊急】重大なデータ矛盾を検出",
        body=f"""
        案件: {case.company_name}
        項目: {conflict.field}
        差異: {conflict.deviation_pct}%
        
        ソースA: {conflict.source_a}
        ソースB: {conflict.source_b}
        
        至急確認をお願いします。
        """,
        priority="critical"
    )
    
    # 3. タスク作成
    create_task(
        title="ARRの定義と値を経営陣に再確認",
        priority="critical",
        due_date=tomorrow(),
        assigned_to=analyst
    )
```

#### Step 2: 確認事項を整理
```markdown
【CFOへの確認事項】

1. **ARRの定義**
   - MRR × 12で計算していますか？
   - それとも年間契約額の合計ですか？
   - 一時金は含みますか？

2. **対象範囲**
   - 全事業ラインを含みますか？
   - 特定の顧客セグメントのみですか？

3. **時点**
   - 財務モデルの数値は何月末時点ですか？
   - インタビューで言及された数値は？

4. **根拠資料**
   - 管理会計上の数値を示す資料を提供いただけますか？
   - SaaSメトリクスダッシュボードのスクリーンショット

5. **なぜ差異が生じたか**
   - ご認識されていますか？
   - 説明をお願いします。
```

#### Step 3: 暫定対応
```markdown
## ARR（暫定）

**重要**: ARRに関して重大な矛盾を検出したため、現在経営陣に確認中。

| ソース | 値 | 時点 | 定義 | 信頼度 |
|--------|-----|------|------|--------|
| 財務モデル | ¥300M | 2024-09 | 不明 | ? |
| CEOインタビュー | ¥450M | 2024-10-01 | MRR×12 | ? |

**差異**: 50%（説明不可）

**暫定評価**: 保守的に¥300Mで分析を進めるが、
確定まで投資判断は保留を推奨。

**次のアクション**:
- CFOへの緊急確認（期限: 10/18）
- 管理会計資料の提出依頼
- 確認後、本資料を更新
```

---

## シナリオ4: LLM抽出精度が著しく低い

### 状況
```
特定の企業Webサイトで抽出精度が50%以下
- JavaScriptレンダリングが必要
- 複雑なHTML構造
- 画像内にテキスト情報
```

### 対応手順

#### Step 1: 診断
```python
def diagnose_extraction_failure(url, html, result):
    """抽出失敗の原因診断"""
    
    issues = []
    
    # 1. JavaScriptレンダリング確認
    if "Loading..." in html or "javascript" in html.lower():
        issues.append({
            "type": "js_rendering_required",
            "solution": "Use Playwright with wait_until='networkidle'"
        })
    
    # 2. コンテンツ量確認
    text_length = len(BeautifulSoup(html).get_text())
    if text_length < 500:
        issues.append({
            "type": "insufficient_content",
            "solution": "Site may be image-heavy or require authentication"
        })
    
    # 3. 言語確認
    if detect_language(html) not in ['ja', 'en']:
        issues.append({
            "type": "unsupported_language",
            "solution": "Add language-specific prompt"
        })
    
    # 4. 構造確認
    if count_nested_divs(html) > 10:
        issues.append({
            "type": "complex_structure",
            "solution": "Improve HTML cleaning"
        })
    
    return issues
```

#### Step 2: 代替手段
```python
# オプション1: 高度なスクレイピング
async def advanced_scraping(url):
    """より高度なスクレイピング"""
    async with async_playwright() as p:
        browser = await p.chromium.launch()
        page = await browser.new_page()
        
        # JavaScriptを待つ
        await page.goto(url, wait_until="networkidle")
        
        # スクロールして遅延ロードコンテンツを表示
        await page.evaluate("window.scrollTo(0, document.body.scrollHeight)")
        await page.wait_for_timeout(2000)
        
        # 特定の要素を待つ
        await page.wait_for_selector('.company-info', timeout=5000)
        
        html = await page.content()
        await browser.close()
        
        return html

# オプション2: OCR（画像内テキスト）
from PIL import Image
import pytesseract

def extract_from_images(page):
    """画像からテキスト抽出"""
    screenshots = page.query_selector_all('img')
    extracted_texts = []
    
    for img in screenshots:
        img_bytes = img.screenshot()
        text = pytesseract.image_to_string(Image.open(img_bytes))
        extracted_texts.append(text)
    
    return '\n'.join(extracted_texts)

# オプション3: 手動入力フォールバック
def fallback_to_manual(url):
    """手動入力にフォールバック"""
    create_task(
        title=f"手動で情報収集: {url}",
        description="自動抽出が失敗したため、手動で基本情報を入力してください",
        assigned_to=analyst,
        priority="high"
    )
```

#### Step 3: プロンプト改善
```python
# より詳細な指示を追加
improved_prompt = """
【注意】このサイトは複雑な構造のため、以下を重視してください：

1. <div class="company-profile"> 内の情報を優先
2. <meta> タグの og:description も確認
3. "会社概要"、"About Us" セクションを重点的に
4. 表形式のデータは行ごとに解析

【抽出優先順位】
1. 明示的に記載されている情報（confidence: 1.0）
2. 構造化データ（JSON-LD、microdata）
3. メタタグ
4. 本文テキスト

不明な場合は無理に抽出せず、nullとしてください。
"""
```

---

## シナリオ5: IC直前の緊急資料作成

### 状況
```
IC: 明後日（48時間後）
状況: 情報収集60%完了
問題: 時間が足りない
```

### 対応手順

#### Step 1: トリアージ（優先順位付け）
```yaml
Must Have（48時間以内必須）:
  □ 投資テーマ（なぜ投資するか）
  □ 市場機会（TAM/SAM）
  □ 競合優位性
  □ チーム
  □ 財務ハイライト（ARR、成長率、Runway）
  □ 投資条件（バリュエーション）
  □ トップ3リスクと対策

Should Have（できれば）:
  □ 詳細なKPI分析
  □ ユニットエコノミクス
  □ 詳細な競合比較
  □ デューデリジェンスサマリー

Nice to Have（後回し）:
  □ 詳細な沿革
  □ 市場トレンド詳細
  □ 追加のベンチマーク分析
```

#### Step 2: 並列作業
```python
import asyncio

async def emergency_preparation(case_id):
    """緊急資料作成（並列処理）"""
    
    # 並列で実行可能なタスク
    tasks = [
        # Critical path
        finalize_investment_thesis(case_id),
        prepare_financial_summary(case_id),
        conduct_ceo_interview(case_id),  # 最優先
        
        # 並列で可能
        gather_market_data(case_id),
        analyze_competition(case_id),
        prepare_team_section(case_id),
    ]
    
    results = await asyncio.gather(*tasks, return_exceptions=True)
    
    # エラーハンドリング
    for i, result in enumerate(results):
        if isinstance(result, Exception):
            log_error(f"Task {i} failed: {result}")
            # フォールバックまたはスキップ
    
    # 最小限の資料を生成
    return generate_minimal_ic_deck(results)
```

#### Step 3: 「不完全版」として提出
```markdown
# 投資委員会資料（暫定版）

**重要な注記**

本資料は時間制約により暫定版として提出されています。
以下の項目は現在調査中であり、IC後に補完予定です：

**完了済み（信頼度: 高）**
- ✅ 投資テーマ
- ✅ 市場機会
- ✅ チーム評価
- ✅ 財務サマリー
- ✅ 投資条件

**暫定・要確認（信頼度: 中）**
- ⚠️ ユニットエコノミクス（推定値）
- ⚠️ 競合分析（主要3社のみ）

**未完了（IC後に補完）**
- ⏳ 詳細なデューデリジェンス
- ⏳ 顧客リファレンス
- ⏳ 技術監査

**推奨**
- 本ICは原則承認とし、詳細DDを条件とする
- または、次回ICで再審議
```

---

## シナリオ6: ユーザーがシステムを信頼しない

### 状況
```
ユーザーの声:
「AIの出した数字は信用できない」
「結局全部チェックするから手間が増えた」
「前のやり方の方が良かった」
```

### 対応手順

#### Step 1: 信頼の可視化
```python
def build_trust_indicators(observation):
    """信頼性指標を明示"""
    
    return {
        "value": observation.value,
        "confidence": observation.confidence,
        "source": observation.source_tag,
        "evidence": observation.evidence,
        
        # 追加の信頼性情報
        "trust_indicators": {
            "verification_method": "LLM抽出 + 人間レビュー",
            "cross_validation": check_cross_validation(observation),
            "historical_accuracy": get_field_accuracy_rate(observation.field),
            "similar_cases": find_similar_validated_cases(observation)
        },
        
        # アクション可能なUI
        "actions": [
            "✓ 承認（このまま使用）",
            "📝 修正（値を変更）",
            "❌ 却下（再取得）",
            "💬 質問（経営陣に確認）"
        ]
    }
```

#### Step 2: 段階的信頼構築
```markdown
Week 1-2: 並行稼働
- 旧プロセスと新システムの両方で実施
- 結果を比較してユーザーに見せる
- 「新システムの方が早く・正確」を実証

Week 3-4: 部分的移行
- 低リスク項目（PUB収集）のみ新システム
- 高リスク項目は従来通り
- 成功体験を積み重ねる

Week 5-6: 段階的拡大
- ユーザーの要望を取り入れて改善
- 「自分たちのシステム」という感覚を醸成

Week 7-8: 完全移行
- 十分な信頼が構築されてから
```

#### Step 3: 透明性の向上
```javascript
// フロントエンドで「どう計算されたか」を表示
<ObservationCard>
  <Value>¥300,000,000</Value>
  <Metadata>
    <Source>CONF - 財務モデル (2024-09-30)</Source>
    <Confidence>100%</Confidence>
    <ExtractedBy>GPT-4o + 人間承認(佐藤)</ExtractedBy>
    <ShowCalculation>
      元データ: "ARR: 3億円"
      抽出ロジック: 数値変換 + 通貨正規化
      検証: 他のソース(INT)と一致
    </ShowCalculation>
  </Metadata>
  
  <UserActions>
    <Button onClick={approve}>✓ 承認</Button>
    <Button onClick={edit}>📝 修正</Button>
    <Button onClick={showEvidence}>📄 証拠を見る</Button>
  </UserActions>
</ObservationCard>
```

---

## まとめ: シナリオ対応の原則

### 1. 透明性の確保
- すべての判断根拠を明示
- 不確実性を隠さない
- ユーザーが検証できる形で情報提供

### 2. 人間の最終判断を尊重
- AIはあくまで支援
- 重要項目は必ず人間がレビュー
- ユーザーの修正を簡単に

### 3. フィードバックループ
- エラーを学習材料に
- ユーザーの修正パターンから改善
- 継続的なプロンプト最適化

### 4. 段階的対応
- 完璧を目指さず、80%の完成度でリリース
- ユーザーと一緒に育てる
- フェーズごとに成功を実感させる


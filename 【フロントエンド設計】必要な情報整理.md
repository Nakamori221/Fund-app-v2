# フロントエンド設計に必要な情報整理

**作成日**: 2025-01-XX
**目的**: フロントエンド開発を開始する前に必要な情報を包括的に整理

---

## 📋 目次

1. [プロジェクト概要](#1-プロジェクト概要)
2. [機能要件](#2-機能要件)
3. [画面構成とナビゲーション](#3-画面構成とナビゲーション)
4. [データモデル](#4-データモデル)
5. [APIエンドポイント](#5-apiエンドポイント)
6. [ユーザーフロー](#6-ユーザーフロー)
7. [承認ワークフロー](#7-承認ワークフロー)
8. [リアルタイム更新](#8-リアルタイム更新)
9. [技術スタック](#9-技術スタック)
10. [UI/UX要件](#10-uiux要件)
11. [セキュリティ要件](#11-セキュリティ要件)
12. [パフォーマンス要件](#12-パフォーマンス要件)
13. [コンポーネント設計チェックリスト](#13-コンポーネント設計チェックリスト)
14. [段階的リリース計画](#14-段階的リリース計画ui視点)
15. [受け入れ基準](#15-受け入れ基準サンプル)
16. [計測とKPI](#16-計測とkpi削減率70への見える化)
17. [アクセシビリティ要件](#17-アクセシビリティ要件)

---

## 1. プロジェクト概要

### 1-1. システムの目的

**投資委員会資料作成の半自動化システム**

- **現状**: 43-65時間/案件の手動作業
- **目標**: 10-15時間/案件（70%削減）
- **主要機能**:
  - AIによる情報収集（PUB/EXT/INT/CONF）
  - データの正規化と矛盾検出
  - 投資委員会資料の自動生成（IC版・LP版）

### 1-2. ユーザーロール

| ロール | 権限 | 主な操作 |
|--------|------|----------|
| **アナリスト** | 基本操作 | 案件作成、情報収集開始、データ確認・編集、レポート生成 |
| **パートナー** | 承認権限 | 承認リクエストの承認/却下、最終レポートの承認 |
| **管理者** | 全権限 | テンプレート管理、ユーザー管理、システム設定 |

---

## 2. 機能要件

### 2-1. コア機能一覧

#### 📊 ダッシュボード
- [ ] 案件一覧表示（ステータス、優先度、担当者別フィルタ）
- [ ] タスク一覧（承認待ち、期限付きタスク）
- [ ] アクティビティフィード（最近の更新、完了作業）
- [ ] 統計情報（進行中案件数、承認待ち数、今週のIC予定）

#### 📝 案件管理
- [ ] 新規案件作成（会社名、ステージ、基本情報入力）
- [ ] 案件詳細表示・編集
- [ ] 案件ステータス管理（draft → in_progress → ready_for_ic → approved）

#### 📥 情報収集
- [ ] PUB収集（WebサイトURL入力、自動収集トリガー、進捗表示、結果確認）
- [ ] EXT収集（外部API連携、進捗表示、結果確認）
- [ ] INT収集（質問票作成・管理、面談記録入力）
- [ ] CONF処理（文書アップロード、抽出結果の承認待ち表示、承認画面）

#### 🔍 データ管理
- [ ] 観測データ一覧表示（セクション別、ソース別フィルタ）
- [ ] 観測データの手動追加・編集・削除
- [ ] データのバージョン履歴表示
- [ ] データの出典・信頼度表示

#### ⚠️ 矛盾検出
- [ ] 矛盾一覧表示（重要度別：Critical/Warning/Info）
- [ ] 矛盾の詳細表示（競合する値、差異率、推奨アクション）
- [ ] 矛盾の解決（値の選択、理由記録）

#### ✅ 承認ワークフロー
- [ ] 承認待ち一覧表示
- [ ] 承認画面（抽出結果の確認、修正、承認/却下）
- [ ] 承認履歴表示
- [ ] 緊急度別通知（Critical: 4時間、High: 24時間）

#### 📄 レポート生成
- [ ] レポート生成（IC版・LP版）
- [ ] レポートプレビュー（Markdown形式）
- [ ] レポート編集（セクション別編集）
- [ ] レポートエクスポート（PDF、Google Docs）

#### ⚙️ 設定
- [ ] テンプレート管理（レポートテンプレートの編集）
- [ ] ユーザー管理（権限設定）
- [ ] 外部連携設定（Crunchbase API、Similarweb API等）

### 2-2. 非機能要件

| 要件 | 詳細 |
|------|------|
| **レスポンシブデザイン** | デスクトップ・タブレット・モバイル対応 |
| **リアルタイム更新** | WebSocketによる進捗・更新通知 |
| **オフライン対応** | 承認専用モバイルアプリ（将来） |
| **パフォーマンス** | 初期ロード < 2秒、ページ遷移 < 500ms |
| **アクセシビリティ** | WCAG 2.1 AA準拠 |

---

## 3. 画面構成とナビゲーション

### 3-1. 画面一覧（階層構造）

```
├─ ダッシュボード（ホーム） (/)
│  ├─ 役割別ホーム（アナリスト/パートナー）
│  ├─ ワークボード（カンバンビュー）
│  ├─ KPIカード（進行中案件・承認待ち・Critical矛盾・今週IC）
│  ├─ "次の一手"リスト（自動提案）
│  └─ 保存ビューウィジェット
│
├─ 案件詳細 (/cases/{case_id})
│  ├─ 3ペインレイアウト
│  │  ├─ 左ペイン: 案件リスト（フィルタ・保存ビュー）
│  │  ├─ 中央ペイン: タブ切り替え
│  │  │  ├─ 概要タブ
│  │  │  ├─ 情報収集タブ
│  │  │  │  ├─ PUB（公開情報）
│  │  │  │  ├─ EXT（外部データ）
│  │  │  │  ├─ INT（インタビュー）
│  │  │  │  └─ CONF（機密資料・文書ビューア）
│  │  │  ├─ 分析タブ
│  │  │  │  ├─ ユニットエコノミクス
│  │  │  │  ├─ 市場規模
│  │  │  │  ├─ 競合分析
│  │  │  │  └─ バリュエーション
│  │  │  ├─ Observationタブ（タイムトラベル・差分表示）
│  │  │  ├─ タスク・質問票タブ
│  │  │  ├─ 矛盾・要確認タブ（矛盾インスペクタ）
│  │  │  └─ レポートタブ（トークン編集・LP/ICトグル）
│  │  └─ 右ペイン: サイドパネル
│  │     ├─ 活動ログ（リアルタイム更新）
│  │     ├─ コメント（ピン留め・メンション）
│  │     └─ 承認ドロワー（即時決裁）
│
├─ レポート生成 (/reports/{report_id})
│  ├─ プレビュー（LP/ICトグル・差分ビュー）
│  ├─ 編集（トークナイズ・マスキング）
│  └─ エクスポート（PDF/Google Docs/Word）
│
├─ 承認インボックス (/approvals)
│  ├─ SLAタイマー付き一覧
│  ├─ バッチ承認
│  └─ 理由テンプレート
│
└─ 設定 (/settings)
   ├─ テンプレート管理
   ├─ ユーザー管理
   ├─ 外部連携設定
   └─ 保存ビュー管理
```

### 3-2. ナビゲーション設計

```
┌──────────────────────────────────────────────────────┐
│  [Logo] Fund Automation        [通知🔔] [User👤]    │
├──────────────────────────────────────────────────────┤
│                                                      │
│  ダッシュボード │ 案件一覧 │ タスク │ 設定           │
│                                                      │
└──────────────────────────────────────────────────────┘
```

**主要ナビゲーション項目:**
- **ダッシュボード**: ホーム画面（統計、アクティビティ）
- **案件一覧**: 全案件の一覧（フィルタ・検索可能）
- **タスク**: 承認待ち、期限付きタスク一覧
- **設定**: システム設定（管理者のみ）

---

## 4. データモデル

### 4-1. 主要エンティティ

#### Case（案件）

```typescript
interface Case {
  id: UUID;
  company_name: string;
  stage: 'seed' | 'early' | 'growth' | 'late';
  status: 'draft' | 'in_progress' | 'ready_for_ic' | 'approved' | 'passed';
  location?: string;
  founded_date?: Date;
  website_url?: string;
  lead_partner_id?: UUID;
  analyst_id?: UUID;
  discovered_at: Date;
  first_meeting_at?: Date;
  ic_date?: Date;
  decision?: 'approved' | 'rejected' | 'deferred';
  decision_at?: Date;
  created_at: Date;
  updated_at: Date;
}
```

#### Observation（観測データ）

```typescript
interface Observation {
  id: UUID;
  case_id: UUID;
  section: string;  // 'basic_info', 'finance', 'team', 'market', etc.
  field: string;    // 'arr', 'employee_count', etc.
  value_type: 'number' | 'string' | 'date' | 'boolean' | 'json';
  value_number?: number;
  value_string?: string;
  value_date?: Date;
  value_boolean?: boolean;
  value_json?: JSON;
  unit?: string;   // 'JPY', 'USD', 'persons', '%'
  source_tag: 'PUB' | 'EXT' | 'INT' | 'CONF' | 'ANL';
  evidence: string; // URL or file reference
  as_of: Date;      // データの時点
  confidence?: number; // 0-1
  disclosure_level: 'IC' | 'LP' | 'LP_NDA' | 'PRIVATE';
  requires_approval: boolean;
  approved_by?: UUID;
  approved_at?: Date;
  notes?: string;
  created_by: UUID;
  created_at: Date;
  updated_at: Date;
}
```

#### Conflict（矛盾）

```typescript
interface Conflict {
  id: UUID;
  case_id: UUID;
  field: string;
  observation_ids: UUID[];
  deviation_pct?: number;
  conflict_type?: 'temporal' | 'definition' | 'value' | 'unknown';
  severity: 'info' | 'warning' | 'error' | 'critical';
  status: 'detected' | 'auto_resolved' | 'escalated' | 'resolved';
  resolution_method?: string;
  resolved_by?: UUID;
  resolved_at?: Date;
  resolution_notes?: string;
  created_at: Date;
  updated_at: Date;
}
```

#### Document（文書）

```typescript
interface Document {
  id: UUID;
  case_id: UUID;
  filename: string;
  file_type: 'pdf' | 'xlsx' | 'docx' | 'pptx';
  file_size_bytes: number;
  storage_path: string;
  doc_type: 'term_sheet' | 'cap_table' | 'financial_model' | 'pitch_deck';
  classification_level: 'L0' | 'L1' | 'L2' | 'L3' | 'L4';
  processing_status: 'uploaded' | 'processing' | 'extracted' | 'error';
  extracted_data?: JSON;
  extraction_error?: string;
  requires_approval: boolean;
  approved_by?: UUID;
  approved_at?: Date;
  uploaded_by: UUID;
  uploaded_at: Date;
}
```

#### Task（タスク）

```typescript
interface Task {
  id: UUID;
  case_id: UUID;
  task_type: 'int_question' | 'conf_request' | 'data_verification' | 'approval';
  title: string;
  description?: string;
  priority: 'low' | 'medium' | 'high' | 'critical';
  importance?: 'critical' | 'high' | 'medium' | 'low';
  assigned_to?: UUID;
  target_role?: string;
  status: 'open' | 'in_progress' | 'completed' | 'cancelled';
  response?: string;
  response_attachments?: string[];
  completed_at?: Date;
  due_date?: Date;
  created_by: UUID;
  created_at: Date;
  updated_at: Date;
}
```

#### WorkflowStage（ワークフローステージ）

```typescript
interface WorkflowStage {
  id: UUID;
  case_id: UUID;
  stage_name: 'pub_collection' | 'ext_collection' | 'conf_processing' | 
              'anl_calculation' | 'int_execution' | 'report_generation';
  status: 'not_started' | 'in_progress' | 'completed' | 'error' | 'blocked';
  progress: number; // 0.0-1.0
  started_at?: Date;
  completed_at?: Date;
  error_message?: string;
  blocked_by?: string;
  metrics?: JSON;
  updated_at: Date;
}
```

### 4-2. フィールド定義辞書

**参考**: `config/field_dictionary_v0_1.json`

主要フィールドの例:
- `revenue_arr`: 年間経常収益（USD）
- `revenue_mrr`: 月次経常収益（USD）
- `net_dollar_retention_annual`: ネットドルレテンション（年率%）
- `ltv_cac_ratio`: LTV/CAC比率
- `deal.investment_amount`: 投資額（USD）
- `deal.valuation_pre`: プレマネー評価額（USD）

詳細は `config/field_dictionary_v0_1.json` を参照。

### 4-3. レポートテンプレート構造

**参考**: `config/report_templates_v0_1.json`

テンプレート構造:
- **IC版**: 全情報を含む完全版
- **LP版**: 機微情報をマスクしたバージョン

各テンプレートは複数のセクションで構成:
1. exec_summary（投資推奨サマリー）
2. company_overview（会社概要）
3. market_analysis（市場分析）
4. competition（競合）
5. kpi_overview（KPI）
6. financials（財務）
7. team（チーム）
8. deal_terms（ディール条件）
9. valuation_return（バリュエーション）
10. risk_mitigation（リスク）
11. value_creation（価値提供）
12. appendix（補足）

---

## 5. APIエンドポイント

### 5-1. Cases API

```typescript
// 案件作成
POST /api/v1/cases
Request: CaseCreate
Response: Case

// 案件一覧取得
GET /api/v1/cases
Query: ?status=in_progress&stage=early&lead_partner_id=xxx
Response: Case[]

// 案件詳細取得
GET /api/v1/cases/{case_id}
Response: Case

// 案件更新
PATCH /api/v1/cases/{case_id}
Request: CaseUpdate
Response: Case

// 案件削除（論理削除）
DELETE /api/v1/cases/{case_id}
Response: { success: boolean }
```

### 5-2. Observations API

```typescript
// 観測データ一覧取得
GET /api/v1/cases/{case_id}/observations
Query: ?section=finance&source_tag=CONF
Response: Observation[]

// 観測データ作成
POST /api/v1/cases/{case_id}/observations
Request: ObservationCreate
Response: Observation

// 観測データ更新
PATCH /api/v1/observations/{obs_id}
Request: ObservationUpdate
Response: Observation

// 観測データ削除
DELETE /api/v1/observations/{obs_id}
Response: { success: boolean }

// 観測データ履歴取得
GET /api/v1/observations/{obs_id}/history
Response: ObservationHistory[]
```

### 5-3. Documents API

```typescript
// 文書アップロード
POST /api/v1/cases/{case_id}/documents
Request: FormData (file, doc_type)
Response: Document

// 文書一覧取得
GET /api/v1/cases/{case_id}/documents
Response: Document[]

// 文書詳細取得
GET /api/v1/documents/{doc_id}
Response: Document

// 抽出トリガー
POST /api/v1/documents/{doc_id}/extract
Response: { status: 'processing' }

// 文書ダウンロード
GET /api/v1/documents/{doc_id}/download
Response: File (binary)
```

### 5-4. Conflicts API

```typescript
// 矛盾一覧取得
GET /api/v1/cases/{case_id}/conflicts
Query: ?severity=critical&status=detected
Response: Conflict[]

// 矛盾詳細取得
GET /api/v1/conflicts/{conflict_id}
Response: Conflict

// 矛盾解決
POST /api/v1/conflicts/{conflict_id}/resolve
Request: ConflictResolution
Response: Conflict
```

### 5-5. Tasks API

```typescript
// タスク一覧取得
GET /api/v1/cases/{case_id}/tasks
Query: ?status=open&priority=high
Response: Task[]

// タスク作成
POST /api/v1/cases/{case_id}/tasks
Request: TaskCreate
Response: Task

// タスク更新
PATCH /api/v1/tasks/{task_id}
Request: TaskUpdate
Response: Task
```

### 5-6. Workflow API

```typescript
// ワークフロー開始
POST /api/v1/cases/{case_id}/workflow/start
Response: { workflow_id: string }

// ワークフロー状態取得
GET /api/v1/cases/{case_id}/workflow/status
Response: {
  stages: WorkflowStage[],
  overall_progress: number,
  current_stage: string
}

// ワークフロー停止
POST /api/v1/cases/{case_id}/workflow/stop
Response: { success: boolean }
```

### 5-7. Reports API

```typescript
// レポート生成
POST /api/v1/cases/{case_id}/reports/generate
Request: { report_type: 'ic' | 'lp' }
Response: { report_id: UUID }

// レポート取得
GET /api/v1/reports/{report_id}
Response: {
  id: UUID,
  report_type: string,
  version: number,
  content_markdown: string,
  content_html: string,
  completion_rate: number,
  pending_items: string[]
}

// レポートエクスポート
POST /api/v1/reports/{report_id}/export
Request: { format: 'pdf' | 'docx' | 'google_docs' }
Response: { export_url: string }
```

### 5-8. Approval API

```typescript
// 承認待ち一覧取得
GET /api/v1/approvals/pending
Query: ?urgency=high&item_type=conf_extraction
Response: ApprovalRequest[]

// 承認リクエスト詳細取得
GET /api/v1/approvals/{approval_id}
Response: ApprovalRequest

// 承認
POST /api/v1/approvals/{approval_id}/approve
Request: { notes?: string }
Response: { success: boolean }

// 却下
POST /api/v1/approvals/{approval_id}/reject
Request: { reason: string }
Response: { success: boolean }

// 修正依頼
POST /api/v1/approvals/{approval_id}/request-revision
Request: { feedback: string }
Response: { success: boolean }
```

### 5-9. WebSocket API

```typescript
// WebSocket接続
WS /ws/cases/{case_id}

// メッセージ形式
{
  type: 'observation_updated' | 'stage_completed' | 'conflict_detected' | 'approval_requested',
  data: { ... }
}
```

---

## 6. ユーザーフロー

### 6-1. 新規案件作成フロー

```
1. ダッシュボード → [新規案件作成] ボタン
2. 案件作成フォーム入力
   - 会社名（必須）
   - ステージ（seed/early/growth/late）
   - WebサイトURL（オプション）
   - 担当パートナー選択
3. [作成] ボタンクリック
4. システムが自動的にワークフロー開始
   - PUB収集開始（WebサイトURLがある場合）
   - ワークフローステージ初期化
5. 案件詳細画面に遷移
6. リアルタイムで進捗更新表示
```

### 6-2. 情報収集フロー（PUB）

```
1. 案件詳細 → [情報収集] タブ
2. PUBセクション表示
   - ステータス: 未開始 / 処理中 / 完了
   - 進捗バー表示
3. [収集開始] ボタンクリック（または自動開始）
4. リアルタイム進捗更新（WebSocket）
   - "企業サイトを取得中..."
   - "情報を抽出中..."
   - "データを保存中..."
5. 完了後、抽出結果を表示
   - 項目別のデータ一覧
   - 出典URL、信頼度表示
6. [確認・承認] → データが正式採用
```

### 6-3. CONF文書処理フロー

```
1. 案件詳細 → [情報収集] タブ → [CONF] セクション
2. [文書をアップロード] ボタン
3. ファイル選択（Term Sheet、Cap Table等）
4. アップロード中インジケーター表示
5. アップロード完了 → 処理開始
   - ステータス: "処理中..."
6. 抽出完了後、承認待ち状態に
   - [承認画面を開く] ボタン表示
7. 承認画面で抽出結果を確認
   - 各項目の値と出典
   - 信頼度スコア
   - 整合性チェック結果
8. [承認] / [修正] / [却下] 選択
9. 承認後、データが正式採用
```

### 6-4. 矛盾解決フロー

```
1. ダッシュボード → 通知（矛盾検出）
2. 案件詳細 → [矛盾・要確認] タブ
3. 矛盾一覧表示（重要度別）
4. 矛盾をクリック → 詳細表示
   - 競合する値の比較
   - 差異率、推奨アクション
5. 解決方法を選択
   - 値Aを採用
   - 値Bを採用
   - 両方を保持し注記
   - 経営陣に再確認
6. [解決する] ボタンクリック
7. 解決理由を記録（オプション）
8. 矛盾が解決済みとしてマーク
```

### 6-5. レポート生成フロー

```
1. 案件詳細 → [レポート] タブ
2. [レポートを生成] ボタン
3. レポートタイプ選択（IC版 / LP版）
4. 生成中インジケーター表示
   - 完了率表示
5. 生成完了後、プレビュー表示
   - Markdown形式
   - セクション別表示
6. 編集・修正（必要に応じて）
7. [エクスポート] ボタン
   - PDF / Google Docs / Word形式
8. エクスポート完了 → ダウンロードリンク表示
```

---

## 7. 承認ワークフロー

### 7-1. 承認が必要なポイント

| ポイント | 対象 | 承認者 | SLA |
|----------|------|--------|-----|
| **CONF文書からの抽出結果** | Term Sheet、Cap Table、財務モデル | Lead Partner | 24時間以内 |
| **重大な矛盾の解決** | 30%以上の数値乖離 | Analyst / Partner | 24時間以内 |
| **外部推計値の採用** | 信頼度 < 70% のデータ | Analyst | 3営業日以内 |
| **最終レポートの公開** | IC提出前、LP配布前 | Lead Partner | 4時間以内 |

### 7-2. 承認画面の構成

```
┌────────────────────────────────────────────────────────┐
│  承認リクエスト: Term Sheet抽出結果                     │
│                                        [×閉じる]       │
├────────────────────────────────────────────────────────┤
│                                                        │
│  📄 Term_Sheet_v3.pdf                                 │
│  アップロード: 2025/10/01 09:00                       │
│                                                        │
│  ┌────────────────────────────────────────────────┐  │
│  │ 抽出された投資条件              信頼度: 95%   │  │
│  ├────────────────────────────────────────────────┤  │
│  │ プレマネー評価額                               │  │
│  │ ¥5,000,000,000                                 │  │
│  │ 出典: p.2 "評価額50億円（プレマネー）"        │  │
│  │ [✓ 正しい] [✗ 修正]                           │  │
│  └────────────────────────────────────────────────┘  │
│                                                        │
│  ⚠️ 要確認事項                                         │
│  - 希薄化防止条項の記述が不明確                       │
│                                                        │
│  [📎 元ファイルを見る]                                │
│                                                        │
│  ┌────────────────────────────────────────────────┐  │
│  │    [承認して反映]  [修正]  [却下]             │  │
│  └────────────────────────────────────────────────┘  │
└────────────────────────────────────────────────────────┘
```

### 7-3. 承認の優先度と通知

**Critical（緊急）:**
- 対象: IC前日の承認、重大な矛盾
- 期限: 4時間以内
- 通知: Slack即時 + メール + SMS

**High（高）:**
- 対象: CONF抽出結果、重要な矛盾
- 期限: 24時間以内
- 通知: Slack + メール

**Medium（中）:**
- 対象: 外部推計値の採用、一般的な矛盾
- 期限: 3営業日以内
- 通知: 社内通知

---

## 8. リアルタイム更新

### 8-1. WebSocket接続

```typescript
// 接続例
const ws = new WebSocket(`wss://api.example.com/ws/cases/${caseId}`);

ws.onmessage = (event) => {
  const message = JSON.parse(event.data);
  
  switch (message.type) {
    case 'observation_updated':
      // 観測データを更新
      updateObservation(message.observation);
      showToast('データが更新されました');
      break;
    
    case 'stage_completed':
      // ステージ完了通知
      updateWorkflowStage(message.stage);
      showToast(`${message.stage} が完了しました`);
      break;
    
    case 'conflict_detected':
      // 矛盾検出通知
      showAlert('データの矛盾が検出されました', 'warning');
      break;
    
    case 'approval_requested':
      // 承認リクエスト通知
      showNotification('承認リクエストがあります', 'high');
      break;
  }
};
```

### 8-2. 更新イベント一覧

| イベントタイプ | 説明 | 通知先 |
|--------------|------|--------|
| `observation_updated` | 観測データが更新された | 案件詳細を見ている全ユーザー |
| `stage_completed` | ワークフローステージが完了 | 案件詳細を見ている全ユーザー |
| `conflict_detected` | 矛盾が検出された | 案件担当者、パートナー |
| `approval_requested` | 承認リクエストが作成された | 承認者 |
| `approval_resolved` | 承認が完了した | リクエスト作成者 |

---

## 9. 技術スタック

### 9-1. 推奨技術スタック

**フロントエンド:**
- **React** 18.2+ (UIライブラリ)
- **TypeScript** 5.0+ (型安全性)
- **Vite** (ビルドツール)
- **React Router** 6.15+ (ルーティング)
- **Zustand** 4.4+ または **Jotai** 2.4+ (状態管理)
- **TanStack Query** 4.35+ (データフェッチ)
- **React Hook Form** 7.45+ (フォーム)
- **Zod** 3.22+ (バリデーション)
- **shadcn/ui** (UIコンポーネント)
- **Tailwind CSS** 3.3+ (スタイリング)
- **Socket.io Client** 4.6+ (WebSocket)
- **date-fns** 2.30+ (日付処理)
- **recharts** 2.8+ (チャート)

**バックエンド（参考）:**
- **FastAPI** (Python)
- **PostgreSQL** (メインDB)
- **Redis** (キャッシュ)
- **Temporal** (ワークフローオーケストレーション)

### 9-2. プロジェクト構成例

```
frontend/
├── src/
│   ├── components/        # UIコンポーネント
│   │   ├── common/       # 共通コンポーネント
│   │   ├── cases/       # 案件関連
│   │   ├── observations/# 観測データ関連
│   │   ├── conflicts/   # 矛盾関連
│   │   ├── approvals/   # 承認関連
│   │   └── reports/     # レポート関連
│   ├── pages/            # ページコンポーネント
│   │   ├── Dashboard.tsx
│   │   ├── CaseDetail.tsx
│   │   └── Settings.tsx
│   ├── hooks/            # カスタムフック
│   │   ├── useWebSocket.ts
│   │   ├── useCase.ts
│   │   └── useObservations.ts
│   ├── store/            # 状態管理
│   │   └── caseStore.ts
│   ├── api/              # APIクライアント
│   │   ├── cases.ts
│   │   ├── observations.ts
│   │   └── reports.ts
│   ├── types/            # TypeScript型定義
│   │   └── index.ts
│   ├── utils/            # ユーティリティ
│   │   ├── formatters.ts
│   │   └── validators.ts
│   └── App.tsx
├── public/
├── package.json
├── tsconfig.json
├── vite.config.ts
└── tailwind.config.js
```

---

## 10. UI/UX要件

### 10-1. デザイン原則（効率化重視）

**3つの基本原則（70%時間削減を実現するための設計指針）:**

1. **画面遷移を減らす（サイドパネル化）**
   - 一覧→詳細→承認→レポートの往復を最小化
   - サイドパネル・ドロワーで連続作業を完結
   - 3ペインレイアウトで常時情報表示

2. **一画面で決着をつける（インライン決裁）**
   - 矛盾解決・承認・差分確認を同一画面で完結
   - ワンクリック決着機能の実装
   - 理由テンプレートで意思決定を高速化

3. **状態と根拠を常に見える化**
   - メタデータ（出典・信頼度・時点）の視覚化
   - バッジ・ツールチップ・ハイライトの標準化
   - データ血統（Lineage）の追跡可能化

### 10-2. カラーパレット（推奨）

```
プライマリー: #2563EB (青)
セカンダリー: #10B981 (緑)
警告: #F59E0B (オレンジ)
エラー: #EF4444 (赤)
成功: #10B981 (緑)
背景: #F9FAFB (グレー)
テキスト: #111827 (ダークグレー)

【ソースタグ色】
PUB: #3B82F6 (青)
EXT: #8B5CF6 (紫)
INT: #EC4899 (ピンク)
CONF: #F59E0B (オレンジ)
ANL: #10B981 (緑)

【開示レベル色】
IC: #059669 (緑)
LP: #3B82F6 (青)
LP_NDA: #F59E0B (オレンジ)
PRIVATE: #EF4444 (赤)
```

### 10-3. 重要なUI要素

**進捗表示:**
- プログレスバー（ワークフローステージの進捗）
- スピナー（ローディング中）
- スケルトンローダー（データ取得中、遷移 < 500msはスケルトン、> 500msは進捗%表示）

**通知（SLAドリブン）:**
- **Critical**: モーダル + トースト + メール/Slack（残時間を赤で強調、4時間以内）
- **High**: バナー + トースト（24時間以内）
- **Medium**: 社内通知（3営業日以内）
- **Digest**: 毎朝の未処理サマリ（案件・承認・矛盾）

**データ表示:**
- テーブル（観測データ一覧、仮想スクロール対応）
- カード（案件概要、統計情報）
- タブ（セクション切り替え）
- 差分表示（前版と現版の視覚差分、±%表示）

**バッジ規約:**
- `PUB/EXT/INT/CONF/ANL`（ソースタグ）
- `IC/LP/LP_NDA/PRIVATE`（開示レベル）
- `High/Med/Low`（信頼度）

### 10-4. 効率化機能（優先度高 → 中）

#### 【優先度：高】役割別ホーム & "ワークボード"化

**アナリストホーム:**
- 自分の案件・未処理タスク・検出済み矛盾・抽出待ち承認を**1つのボード**に統合
- ドラッグ＆ドロップでステータス更新
- カンバンビューで可視化

**パートナーホーム:**
- **SLAタイマー付き承認インボックス**
  - Critical/Highの緡切まで残時間を強調表示
  - インライン承認可能
  - バッチ承認機能

**実装例:**
```typescript
interface WorkBoard {
  id: string;
  name: string;
  columns: BoardColumn[];
  filters: SavedView;
}

interface BoardColumn {
  id: string;
  name: string; // '未着手' | '進行中' | '承認待ち' | '完了'
  items: (Case | Task | Conflict)[];
}
```

#### 【優先度：高】コマンドパレット（⌘/Ctrl + K）とグローバル検索

**機能:**
- Case/Observation/Conflict/Document/Reportを横断検索
- 直近アクセス・保存済みフィルタ
- クイックアクション（「新規案件」「収集開始」「レポート生成」）

**主要ショートカット:**
```
⌘/Ctrl + K: コマンドパレット開く
⌘/Ctrl + /: グローバル検索
g c: 案件一覧へ移動
g t: タスクへ移動
a a: 承認インボックスへ移動
r g: レポート生成
n c: 新規案件作成
```

**実装例:**
```typescript
interface CommandPalette {
  searchQuery: string;
  results: CommandResult[];
  recentCommands: Command[];
}

interface CommandResult {
  type: 'case' | 'observation' | 'task' | 'action';
  id: string;
  title: string;
  subtitle?: string;
  icon: string;
  action: () => void;
  shortcut?: string;
}
```

#### 【優先度：高】3ペイン「案件詳細」レイアウト

```
┌─────────────┬──────────────────────┬────────────────┐
│ 案件リスト  │ タブ（概要/収集/分析/ │ 右サイドパネル │
│ (フィルタ/  │ 矛盾/レポート）本文   │ 活動/コメント/ │
│ 保存ビュー) │ （表・チャート・フォーム）│ 承認ドロワー   │
└─────────────┴──────────────────────┴────────────────┘
```

**左ペイン（案件リスト）:**
- 案件一覧（フィルタ・検索・保存ビュー）
- 幅: 300-400px（リサイズ可能）

**中央ペイン（メインコンテンツ）:**
- タブ切り替え（概要/情報収集/分析/タスク/矛盾/レポート）
- 表・チャート・フォーム表示

**右ペイン（常設サイドパネル）:**
- 活動ログ（リアルタイム更新）
- コメント（ピン留め可能）
- 承認ドロワー（即時決裁）
- 幅: 350-400px（折りたたみ可能）

**利点:**
- どのタブからでも承認・コメント可能
- 往復操作を削減
- コンテキストの維持

#### 【優先度：高】Observationビューの"タイムトラベル" & 差分（diff）

**機能:**
- フィールドごとに**時系列スライダー**／**as_ofセレクタ**
- **出典別の値比較**（PUB/EXT/INT/CONF）を縦並びで表示
- **差分%**と**信頼度**を自動表示
- **採用ボタン**で1クリック採用＋理由テンプレ登録

**UI例:**
```typescript
interface ObservationTimeTravel {
  field: string;
  currentValue: ObservationValue;
  historicalValues: ObservationValue[];
  sourceComparison: {
    source: 'PUB' | 'EXT' | 'INT' | 'CONF';
    value: number;
    as_of: Date;
    confidence: number;
    diff_pct?: number;
  }[];
}

// 表示例
┌─────────────────────────────────────┐
│ revenue_arr                         │
├─────────────────────────────────────┤
│ 現在の値: $12.0M (CONF, 2025-06)   │
│                                     │
│ 時系列スライダー: [2024-01]━━━●━━━━[2025-06]│
│                                     │
│ 出典別比較:                         │
│ ├─ CONF: $12.0M (100%, 2025-06)   │ ← 推奨
│ ├─ INT:  $11.5M (90%,  2025-05)    │
│ ├─ EXT:  $10.8M (70%,  2025-04)    │
│ └─ PUB:  $9.1M  (60%,  2025-03)    │
│                                     │
│ 差異: +31.9% (PUB vs CONF)         │
│ [CONFを採用] [INTを採用] [両方保持] │
└─────────────────────────────────────┘
```

#### 【優先度：高】矛盾インスペクタ

**機能:**
- 重み付けルール（CONF > INT > EXT > PUB）をUIで可視化
- 推奨値を先頭に提示
- ワンクリック決着＋理由の定型化

**UI例:**
```
[⚠ Critical] revenue_arr

┌─────────────────────────────────────────────┐
│ ① $12.0M (CONF, as_of 2025-06)            │ ← 推奨
│    信頼度: 100%                             │
│    出典: 財務モデル                         │
│                                             │
│ ② $9.1M (PUB, as_of 2025-03)              │
│    信頼度: 60%                              │
│    出典: https://example.com/press          │
│                                             │
│ 差異: +31.9%                               │
│                                             │
│ 理由候補:                                   │
│ ○ 季節性の違い                             │
│ ○ 定義差（MRR×12 vs 年契約額）             │
│ ○ 為替レートの変動                         │
│ ○ 入力誤りの可能性                         │
│                                             │
│ [①を採用] [②を採用] [両方保持+注記] [再確認依頼]│
└─────────────────────────────────────────────┘
```

#### 【優先度：高】文書ビューア + 抽出結果の同期ハイライト

**レイアウト:**
```
┌──────────────────────┬─────────────────────┐
│ PDF/スライドビューア │ 抽出項目テーブル     │
│                      │                     │
│ [ページ1]            │ プレマネー評価額    │
│ ...                  │ ¥5,000,000,000     │
│                      │ [出典: p.2] [ジャンプ→]│
│                      │                     │
│                      │ 投資額              │
│                      │ ¥1,000,000,000     │
│                      │ [出典: p.2] [ジャンプ→]│
└──────────────────────┴─────────────────────┘
```

**機能:**
- 抽出項目をクリック→該当ページ・本文にジャンプ＆ハイライト
- "根拠を見る"で出典を即参照
- "値を修正"で右側セル編集
- 承認/修正/却下を同一画面で完結

#### 【優先度：高】承認ドロワー

**機能:**
- 画面右からドロワーで開閉（モバイルはスワイプ）
- **バッチ承認**（複数件を一括承認）
- **差し戻し理由テンプレ**（よく使う理由を保存）
- **SLAタイマー**（残時間を強調表示）
- **代行ルーティング**（不在時の代理承認者設定）

**UI例:**
```
┌──────────────────────────────────────┐
│ 承認インボックス              [×閉じる]│
├──────────────────────────────────────┤
│ 🔴 Critical (残り2時間30分)         │
│ Acme社 - Term Sheet抽出結果           │
│ [承認] [修正依頼] [却下]              │
├──────────────────────────────────────┤
│ 🟡 High (残り18時間)                  │
│ Beta社 - CONF抽出結果                 │
│ [承認] [修正依頼] [却下]              │
├──────────────────────────────────────┤
│ [バッチ選択] [一括承認]               │
└──────────────────────────────────────┘
```

#### 【優先度：高】レポートトークナイズ編集とLP/ICトグル

**機能:**
- Markdown本文に**`{{field.revenue_arr}}`**のようなトークンを差し込み
- **プレビューで即展開**
- **LP/ICトグル**で機微情報を自動マスク
- **差分ビュー**で"IC→LP"の相違を確認
- 未充足セクションの**完了率**＆**TODO抽出**

**UI例:**
```
┌──────────────────────────────────────┐
│ レポートエディタ                      │
├──────────────────────────────────────┤
│ [IC版] [LP版] ← トグル                │
│                                      │
│ ## 投資推奨サマリー                   │
│                                      │
│ 投資額: {{field.deal.investment_amount}}│
│ → $10,000,000 (プレビュー時展開)    │
│                                      │
│ [プレビュー] [差分表示] [エクスポート]│
└──────────────────────────────────────┘
```

#### 【優先度：中】保存ビュー／スマートフィルタ／共有リンク

**機能:**
- 例：「**IC前7日以内**かつ**Critical矛盾あり**かつ**承認未完**」
- 保存して共有（権限連動）
- URL共有リンク生成

#### 【優先度：中】アクティビティ＆データ血統（Lineage）

**機能:**
- 値の来歴（誰が／いつ／どの出典で）を**ツールチップ**で常時表示
- **1クリックで前版にロールバック**

**UI例:**
```typescript
interface DataLineage {
  currentValue: {
    value: number;
    updatedBy: User;
    updatedAt: Date;
    source: string;
  };
  history: {
    version: number;
    value: number;
    changedBy: User;
    changedAt: Date;
    reason: string;
  }[];
}
```

#### 【優先度：中】自動サマリ＆後続アクション

**機能:**
- 収集完了／矛盾解決／承認完了の都度、**"次にやるべき3件"**を上部に提案
- ミニタスク化

#### 【優先度：中】バルク操作

**機能:**
- Observation一括編集
- 出典更新
- 開示レベル一括変更
- バッチ承認

#### 【優先度：中】コメント／メンション／スレッド

**機能:**
- 任意セル・段落・コンポーネントに**ピン留めコメント**
- `@名前`で通知
- Slack連携は**URLディープリンク**で該当ビューへ

#### 【優先度：中】用語辞書の内蔵化

**機能:**
- フィールド名に**定義ツールチップ**（`config/field_dictionary`）を紐づけ
- 定義差の誤解を予防

#### 【優先度：中】エラー＆再試行UX

**機能:**
- 収集・抽出・生成の**ジョブログ**表示
- **再実行**ボタン
- **原因別ガイダンス**（エラーメッセージを分かりやすく）
- WebSocketイベントとトースト／バナーの優先度整理

---

## 11. セキュリティ要件

### 11-1. 認証・認可

- **認証方式**: JWT (JSON Web Token)
- **トークン有効期限**: 24時間（リフレッシュトークン有効期限: 7日）
- **権限管理**: ロールベースアクセス制御（RBAC）

### 11-2. データ保護

- **機密データ**: CONF文書は暗号化保存
- **データ分類**: L0-L4の分類レベルに応じたアクセス制御
- **監査ログ**: 全操作をログ記録

### 11-3. CORS設定

```typescript
// 許可するオリジン
allowedOrigins: [
  'https://app.yourfund.com',
  'https://admin.yourfund.com'
]
```

### 11-4. UI層でのセキュリティ実装

**ロールベースUI（RBAC）:**
- 要素ごとに**不可視／リードオンリー／編集可**を切替
- 権限のない機能は表示しない（セキュリティバイデザイン）

**開示レベル水印:**
- LP配布時は自動透かし表示（"Limited Partner Distribution"）
- スクリーンショット防止（CSS `user-select: none`）

**コピー時の警告:**
- PRIVATEデータをコピーすると警告＋ログ記録
- クリップボード監視（監査用）

**実装例:**
```typescript
// 権限チェック
const canEdit = usePermission('case:edit');
const canApprove = usePermission('approval:create');

// 条件付きレンダリング
{canEdit && <EditButton />}
{canApprove && <ApproveButton />}

// コピー監視
useEffect(() => {
  const handleCopy = (e: ClipboardEvent) => {
    if (isPrivateData(e.target)) {
      e.preventDefault();
      logCopyAttempt(e.target);
      showWarning('機密データのコピーは記録されます');
    }
  };
  document.addEventListener('copy', handleCopy);
  return () => document.removeEventListener('copy', handleCopy);
}, []);
```

---

## 17. アクセシビリティ要件

### 17-1. WCAG 2.1 AA準拠

**必須項目:**
- **キーボード操作到達率100%**: 全機能がキーボードで操作可能
- **フォーカスリングの統一**: 全インタラクティブ要素に一貫したフォーカス表示
- **スクリーンリーダー対応**: ARIAラベル、ロール、状態の適切な設定
- **色のコントラスト**: 4.5:1以上のコントラスト比
- **代替テキスト**: 画像・アイコンに適切なalt属性

**実装例:**
```typescript
// ARIA属性の設定
<button
  aria-label="承認"
  aria-describedby="approval-hint"
  aria-pressed={isPressed}
>
  承認
</button>
<span id="approval-hint" className="sr-only">
  この操作は承認ワークフローを開始します
</span>

// キーボード操作
onKeyDown={(e) => {
  if (e.key === 'Enter' || e.key === ' ') {
    handleApprove();
  }
}}
```

### 17-2. ショートカット一覧

**グローバル:**
- `⌘/Ctrl + K`: コマンドパレット
- `⌘/Ctrl + /`: グローバル検索
- `Esc`: モーダル・ドロワーを閉じる

**ナビゲーション:**
- `g c`: 案件一覧へ移動
- `g t`: タスクへ移動
- `a a`: 承認インボックスへ移動
- `n c`: 新規案件作成

**操作:**
- `⌘/Ctrl + Enter`: フォーム送信
- `⌘/Ctrl + S`: 保存
- `⌘/Ctrl + /`: ヘルプ表示

**実装:**
- ショートカットキーは画面下部に常時表示（オプション）
- 初回ログイン時にチュートリアル表示

---

## 12. パフォーマンス要件

### 12-1. 目標値

| 項目 | 目標値 |
|------|--------|
| **初期ロード時間** | < 2秒 |
| **ページ遷移** | < 500ms |
| **API応答時間** | < 300ms |
| **リアルタイム更新遅延** | < 100ms |

### 12-2. 最適化手法（Non-Functional要件を確実に満たす）

**必須実装項目:**

1. **ルート単位コード分割 + 重要コンポーネントの遅延ロード**
   - 各ページを動的インポート
   - 重いコンポーネント（PDF Viewer、チャート等）は遅延読み込み

2. **TanStack Queryでのデータキャッシュ／プリフェッチ**
   - 案件一覧→詳細の遷移を体感即時化
   - 関連データのプリフェッチ（ホバー時に先行取得）

3. **仮想スクロール**
   - Observation/Document/Activityの長一覧で必須
   - `@tanstack/react-virtual`または`react-window`を使用

4. **Skeleton/Optimistic UI**
   - 遷移 < 500msはスケルトン表示
   - 遷移 > 500msはローディング＋進捗%表示
   - オプティミスティック更新で体感速度向上

5. **WebSocket接続の最適化**
   - 接続プーリング
   - メッセージのバッチ処理
   - 接続切断時の自動再接続

**実装例:**
```typescript
// コード分割
const CaseDetail = lazy(() => import('./pages/CaseDetail'));
const ReportEditor = lazy(() => import('./pages/ReportEditor'));

// プリフェッチ
const { data } = useQuery(['cases'], fetchCases);
useEffect(() => {
  // ホバー時に詳細データを先行取得
  data?.forEach(case => {
    queryClient.prefetchQuery(['case', case.id], () => fetchCase(case.id));
  });
}, [data]);

// 仮想スクロール
import { useVirtualizer } from '@tanstack/react-virtual';

const virtualizer = useVirtualizer({
  count: observations.length,
  getScrollElement: () => parentRef.current,
  estimateSize: () => 50,
});
```

---

## 13. コンポーネント設計チェックリスト

### 13-1. 必須コンポーネント

**DataTable（観測データ一覧用）:**
- [ ] 仮想スクロール対応（大量データ表示）
- [ ] カラム設定保存（表示/非表示、順序、幅）
- [ ] サマリ行（合計・平均等）
- [ ] 行内編集（インライン編集）
- [ ] ソート・フィルタ（複数条件対応）
- [ ] バッチ選択・一括操作

**Side Drawer / Panel:**
- [ ] 承認ドロワー（右側からスライド）
- [ ] コメントパネル
- [ ] 詳細ログビューア
- [ ] モバイル対応（スワイプ操作）

**DiffRow（差分表示）:**
- [ ] 前版と現版の視覚差分（±%、色分け）
- [ ] 出典バッジ表示
- [ ] ツールチップ（詳細情報）
- [ ] 採用ボタン（ワンクリック）

**PDF Viewer with Anchors:**
- [ ] PDF/スライドビューア
- [ ] 抽出フィールドへのアンカー
- [ ] 同期ハイライト
- [ ] ページジャンプ機能

**KPI Cards:**
- [ ] SLAタイマー表示（残時間強調）
- [ ] トレンド表示（前週/前月比較）
- [ ] クリック可能（詳細ページへ遷移）

**Notification Center:**
- [ ] 種類別フィルタ（Critical/High/Medium）
- [ ] 未読/既読管理
- [ ] 一括既読・削除
- [ ] 優先度別ソート

**Command Palette:**
- [ ] アクション検索・実行
- [ ] 履歴表示（最近のコマンド）
- [ ] ショートカット学習モード
- [ ] カテゴリ別グループ化

### 13-2. コンポーネント実装例（TypeScript）

```typescript
// DataTable
interface DataTableProps<T> {
  data: T[];
  columns: Column<T>[];
  virtualized?: boolean;
  sortable?: boolean;
  filterable?: boolean;
  editable?: boolean;
  onCellEdit?: (row: T, field: string, value: any) => void;
  batchActions?: BatchAction[];
}

// ConflictInspector
interface ConflictInspectorProps {
  conflict: Conflict;
  observations: Observation[];
  onResolve: (resolution: ConflictResolution) => void;
  recommendation?: Observation;
  reasonTemplates?: string[];
}

// ApprovalDrawer
interface ApprovalDrawerProps {
  approvals: ApprovalRequest[];
  onApprove: (id: string, notes?: string) => void;
  onReject: (id: string, reason: string) => void;
  onBatchApprove?: (ids: string[]) => void;
  slaTimer?: boolean;
}

// ObservationTimeTravel
interface ObservationTimeTravelProps {
  field: string;
  observations: Observation[];
  currentValue: Observation;
  onAdopt: (observation: Observation, reason?: string) => void;
  showComparison?: boolean;
}
```

---

## 14. 段階的リリース計画（UI視点）

### Phase 1（必須土台） - MVP

**目標**: 基本的な案件管理と情報収集の効率化

**機能:**
- [x] 認証・認可（JWT、RBAC）
- [ ] 役割別ホーム
- [ ] 3ペイン案件詳細レイアウト
- [ ] Observationタイムトラベル（基本版）
- [ ] コマンドパレット（⌘+K）
- [ ] 通知センター（SLAドリブン）

**期待効果**: 画面遷移削減30%、基本操作の時間短縮

### Phase 2（決裁と整合性） - 承認高速化

**目標**: 承認と矛盾解決の時間を大幅短縮

**機能:**
- [ ] 矛盾インスペクタ（ワンクリック決着）
- [ ] 承認ドロワー（バッチ承認・理由テンプレ）
- [ ] PDF同期ハイライト（文書ビューア）
- [ ] Observation差分表示（完全版）
- [ ] データ血統（Lineage）表示

**期待効果**: 承認時間50%削減、矛盾解決時間60%削減

### Phase 3（アウトプットの質） - レポート生成効率化

**目標**: レポート作成・修正の時間短縮

**機能:**
- [ ] レポートトークナイズ編集
- [ ] LP/ICトグル（自動マスキング）
- [ ] 差分ビュー（IC→LP相違確認）
- [ ] プレフライトチェック（未記入・未承認・矛盾の自動検査）
- [ ] エクスポート最適化

**期待効果**: レポート作成時間40%削減

### Phase 4（生産性の底上げ） - 高度な機能

**目標**: チーム全体の生産性向上

**機能:**
- [ ] 保存ビュー／共有（権限連動）
- [ ] バルク操作（一括編集・承認）
- [ ] コメント／メンション／スレッド
- [ ] 自動サマリ＆後続アクション提案
- [ ] 用語辞書内蔵化
- [ ] 作業時間トラッキング

**期待効果**: 全体効率10-15%の追加改善

---

## 15. 受け入れ基準（サンプル）

### 15-1. Observation差分機能

**要件:**
- 任意フィールドで**前回値→今回値の差分%**・出典・as_ofが**1画面**で確認できる
- **1クリック採用**＋理由テンプレが保存できる

**テストシナリオ:**
1. `revenue_arr`フィールドで複数ソース（PUB/EXT/CONF）の値を表示
2. 差分%が自動計算されることを確認
3. CONF値をクリックで採用
4. 理由テンプレートを選択して保存

### 15-2. 承認機能

**要件:**
- 承認ドロワーから**10件を一括承認**できる
- SLA超過警告が出る

**テストシナリオ:**
1. 承認インボックスを開く
2. 10件をチェックボックスで選択
3. 「一括承認」ボタンをクリック
4. 確認ダイアログが表示される
5. 承認完了後、SLA超過警告（Critical）が表示される

### 15-3. レポートLP/ICトグル

**要件:**
- LP/ICトグルで**表示差分が可視化**される
- エクスポート時に**マスクが適用**される

**テストシナリオ:**
1. レポートエディタで「IC版」を表示
2. 「LP版」にトグル
3. 機微情報（deal.investment_amount等）がマスク表示されることを確認
4. 差分ビューで変更箇所がハイライトされる
5. PDFエクスポート時にマスクが適用されている

---

## 16. 計測とKPI（削減率70%への"見える化"）

### 16-1. 作業時間トラッキング

**計測項目:**
- 収集開始→完了までの時間
- 承認依頼→承認完了までの時間
- 矛盾検出→解決までの時間
- レポート生成→最終承認までの時間

**表示:**
- ダッシュボードに平均所要時間を表示
- 週次レポートで傾向分析
- ボトルネックTOP3を自動掲示

### 16-2. SLA遵守率

**計測項目:**
- Critical承認: 4時間以内の遵守率
- High承認: 24時間以内の遵守率
- 矛盾一次解決率
- レポート手戻り率

**目標値:**
- Critical承認遵守率: > 95%
- High承認遵守率: > 90%
- 矛盾一次解決率: > 80%

### 16-3. 効率化指標

**計測項目:**
- 画面遷移回数（一覧→詳細→承認）
- 承認操作の所要時間（平均）
- コマンドパレット使用率
- バッチ操作の使用率

**目標値:**
- 画面遷移回数: 50%削減（現状: 平均10回/案件 → 5回/案件）
- 承認操作時間: 60%削減（現状: 平均5分 → 2分）

---

## 📝 次のステップ

1. **デザインシステムの構築**
   - shadcn/uiの設定
   - Tailwind CSSのカスタマイズ（カラーパレット・バッジ規約）
   - コンポーネントライブラリの整備

2. **プロジェクトセットアップ**
   - Vite + React + TypeScriptの初期化
   - ルーティング設定
   - APIクライアントの実装
   - WebSocket接続の実装

3. **Phase 1実装（必須土台）**
   - 認証・認可
   - 役割別ホーム（ワークボード）
   - 3ペイン案件詳細レイアウト
   - コマンドパレット（⌘+K）
   - 通知センター

4. **テスト戦略**
   - ユニットテスト（Vitest）
   - 統合テスト（React Testing Library）
   - E2Eテスト（Playwright）
   - パフォーマンステスト（Lighthouse）

5. **計測・分析の実装**
   - 作業時間トラッキング
   - SLA遵守率ダッシュボード
   - 効率化指標の可視化

---

## 18. 総評と設計方針

### 18-1. 現状計画の強み

**✅ 情報アーキテクチャ:**
- エンティティ（Case/Observation/Conflict/Document/Task）で整理
- APIも粒度が適切。フロントから見て「必要なデータは揃う」構成

**✅ ワークフロー設計:**
- ワークフロー段階とWebSocketイベントが明確
- リアルタイムUIを設計しやすい。通知・進捗設計に発展可能

**✅ レポート分離:**
- IC版／LP版を分離しており、権限・開示レベルをUIに落とし込みやすい

### 18-2. 改善点（効率化への指針）

**⚠️ 画面遷移の多さ:**
- 一覧→詳細→承認→レポートという長い流れで往復が多くなりがち
- **解決策**: サイドパネル／ドロワーで連続作業を完結できる設計

**⚠️ メタデータの可視化不足:**
- Observationの「時点」「出典」「信頼度」「開示レベル」が暗黙知のまま
- **解決策**: 視覚的メタデータ（バッジ／色／ツールチップ）の標準化

**⚠️ 決裁操作の分散:**
- ConflictとApprovalは業務クリティカルにもかかわらず、別画面での操作になりやすい
- **解決策**: 「一画面決裁」の導入で摩擦を減らす

**⚠️ パフォーマンス実装指針の明文化:**
- 非機能要件（初期ロード＜2秒／遷移＜500ms）を満たすには前提設計が必要
- **解決策**: 仮想スクロール・クエリキャッシュ・ルート分割の実装指針を明文化（本ドキュメントで対応済み）

### 18-3. 3つの基本原則（70%時間削減を実現するための設計指針）

1. **画面遷移を減らす（サイドパネル化）**
   - 一覧→詳細→承認→レポートの往復を最小化
   - サイドパネル・ドロワーで連続作業を完結
   - 3ペインレイアウトで常時情報表示

2. **一画面で決着をつける（インライン決裁）**
   - 矛盾解決・承認・差分確認を同一画面で完結
   - ワンクリック決着機能の実装
   - 理由テンプレートで意思決定を高速化

3. **状態と根拠を常に見える化**
   - メタデータ（出典・信頼度・時点）の視覚化
   - バッジ・ツールチップ・ハイライトの標準化
   - データ血統（Lineage）の追跡可能化

### 18-4. 優先実装機能の効果予測

| Phase | 機能 | 期待効果 |
|-------|------|----------|
| **Phase 1** | 3ペインレイアウト、コマンドパレット | 画面遷移削減30% |
| **Phase 2** | 矛盾インスペクタ、承認ドロワー | 承認時間50%削減、矛盾解決60%削減 |
| **Phase 3** | レポートトークン編集、LP/ICトグル | レポート作成時間40%削減 |
| **Phase 4** | 保存ビュー、バルク操作 | 全体効率10-15%の追加改善 |

**累積効果**: Phase 1-4の実装により、目標の**70%時間削減**を達成可能

---

## 📚 参考資料

- **UI設計書**: `【5】UI設計と人間承認フロー.md`
- **データモデル**: `【4】データモデルとアーキテクチャの詳細設計.md`
- **技術スタック**: `【7】技術スタック詳細と選定ガイド.md`
- **データフロー**: `【13】データフロー・シーケンス図.md`
- **フィールド定義**: `config/field_dictionary_v0_1.json`
- **レポートテンプレート**: `config/report_templates_v0_1.json`

---

**このドキュメントを基にフロントエンド開発を開始できます。**

**次のアクション:**
1. Phase 1の機能から実装を開始
2. コンポーネント設計チェックリストに沿って開発を進める
3. 受け入れ基準を満たすことを確認しながら実装

